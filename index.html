<html lang="zh-HK"><head><style>body {transition: opacity ease-in 0.2s; } 
body[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } 
</style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayMe åˆ©æ˜¯ Â· è‡ªè¨‚å„ªæƒ </title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        h1 { color: #333; margin-bottom: 10px; }
        .subtitle { 
            color: #666; 
            margin-bottom: 30px;
            background: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            display: block;
        }
        .loading { color: #666; margin: 20px 0; }
        .error-box {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .user-badge {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #1976d2;
            font-weight: 500;
        }
        .link-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .offer-info {
            flex: 2;
            text-align: left;
            min-width: 200px;
        }
        .price-tag {
            font-weight: bold;
            color: #0098ea;
            font-size: 1.1em;
            display: block;
            margin-bottom: 4px;
        }
        .offer-url {
            font-size: 11px;
            color: #666;
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            word-break: break-all;
            display: inline-block;
            max-width: 100%;
        }
        .pay-btn {
            background: #0098ea;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            min-width: 80px;
        }
        .pay-btn:hover { background: #0087d1; }
        .pay-btn:disabled {
            background: #ccc;
            cursor: wait;
        }
        .edit-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        .edit-btn:hover { background: #5a6268; }
        .edit-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-top: 30px;
            border-radius: 8px;
            text-align: left;
        }
        .edit-section h4 {
            margin-top: 0;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .form-row {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        .form-row .form-group {
            flex: 1;
        }
        .save-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }
        .save-btn:hover { background: #218838; }
        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        .delete-btn:hover { background: #c82333; }
        .add-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        .add-btn:hover { background: #138496; }
        .note {
            font-size: 12px;
            color: #666;
            margin-top: 15px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        .cors-warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 13px;
        }
        .mock-badge {
            background: #fff3e0;
            color: #e65100;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            margin-left: 10px;
        }
        .button-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
    </style>
<style>
  .imageye-selected {
    outline: 2px solid black !important;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5) !important;
  }
</style></head>
<body>
    <div class="container">
        <h1>ğŸ’° PayMe åˆ©æ˜¯ Â· è‡ªè¨‚é€£çµ</h1>
        <p class="subtitle">
            ğŸ ä½ å¯ä»¥ä»»æ„ä¿®æ”¹ä¸‹æ–¹çš„å„ªæƒ åç¨±åŠ PayMe é€£çµ (è‡ªå‹•å„²å­˜)
            <span class="mock-badge">é›¢ç·šç·¨è¼¯ Â· æ°¸ä¹…æœ‰æ•ˆ</span>
        </p>
        
        <div id="error-box" class="error-box"></div>
        
        <div id="content-area">
            <div class="user-badge">
                ğŸ‘¤ <span id="user-name">ç·¨è¼¯è€…</span>
                <span style="font-size:12px; margin-left:8px;">ğŸ”’ è³‡æ–™å„²å­˜åœ¨ä½ çš„ç€è¦½å™¨</span>
            </div>
            
            <div class="cors-warning" id="cors-warning" style="display: none;">
                âš ï¸ ç„¡æ³•é€£æ¥ HSBC ä¼ºæœå™¨ (CORS é˜»æ“‹)ã€‚<br>
                <strong>ä½¿ç”¨ã€Œç¤ºç¯„æ¨¡å¼ã€â€”â€” Token ç‚ºæ¨¡æ“¬è³‡æ–™ï¼Œä½†ä»å¯é–‹å•Ÿä½ çš„è‡ªè¨‚é€£çµã€‚</strong>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="margin: 0; color: #333;">ğŸ“‹ å„ªæƒ åˆ—è¡¨ (é»æ“Šé ˜å–)</h3>
                <button id="addNewOfferBtn" class="add-btn">â• æ–°å¢å„ªæƒ </button>
            </div>
            
            <div id="links-container"></div>
            
            <div class="note">
                ğŸ’¡ æ¯å€‹å„ªæƒ éƒ½å¯ä»¥ç·¨è¼¯åç¨±å’Œ PayMe URLã€‚æ‰€æœ‰è®Šæ›´æœƒè‡ªå‹•å­˜å…¥ç€è¦½å™¨ã€‚<br>
                ğŸ“± æŒ‰ã€Œé ˜å–ã€æœƒå˜—è©¦åŠ  token ä¸¦é–‹å•Ÿé€£çµ (CORS å¤±æ•—å‰‡ç”¨æ¨¡æ“¬ token)ã€‚
            </div>
        </div>
    </div>

    <script>
        // --------------------------------------------
        //  GitHub Pages éœæ…‹ç‰ˆ - å®Œå…¨å¯ç·¨è¼¯ PayMe é€£çµ
        //  æ‰€æœ‰ä¿®æ”¹å„²å­˜åœ¨ localStorageï¼Œç„¡éœ€å¾Œç«¯
        // --------------------------------------------

        // HSBC API Key (ä¿ç•™ï¼Œä½†å‰ç«¯ fetch æœƒå›  CORS å¤±æ•—)
        const HSBC_API_KEY = '9104b7e6-ded0-4998-a019-074477573c46';
        const HSBC_API_URL = 'https://paymepromotions.hsbc.com.hk/api/tc/draw/time-token';
        
        // æ¨¡æ“¬ Token - ç•¶ CORS å¤±æ•—æ™‚è‡ªå‹•ä½¿ç”¨
        const MOCK_TOKEN = 'gh-pages-edit-token-' + Date.now();

        // å„²å­˜éµå
        const STORAGE_KEY = 'payme_offers_list';

        // ------------------- é è¨­å„ªæƒ  (è‹¥ localStorage ç‚ºç©º) -------------------
        const DEFAULT_OFFERS = [
            { id: '1', name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $3-$3', url: 'https://payme.hsbc/m/c90f69cb-04a8-447c-9ea5-9a8849563bd8' },
            { id: '2', name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $5-$5', url: 'https://payme.hsbc/m/258c37c8-4cf7-4a3e-8559-8373eff05043' },
            { id: '3', name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $120-$8', url: 'https://payme.hsbc/m/35c76840-8a98-4b04-b468-301add0e67dd' },
            { id: '4', name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $168-$10', url: 'https://payme.hsbc/m/dc6f7a27-90ee-42f2-9425-c65e9b0b54cb' },
            { id: '5', name: 'æ–°åœ°å•†å ´éŠ€è¯æ”¯ä»˜å›è´ˆåˆ¸ $500å›$38', url: 'https://payme.hsbc/m/94498590-b8e4-4721-bb52-954e9028087c' },
            { id: '6', name: 'æ–°åœ°å•†å ´éŠ€è¯æ”¯ä»˜å›è´ˆåˆ¸ $2000å›$128', url: 'https://payme.hsbc/m/7cd803a8-604b-4baa-9bcc-b2706f3d313a' }
        ];

        // ------------------- è®€å–/å„²å­˜è³‡æ–™ -------------------
        function loadOffers() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    return [...DEFAULT_OFFERS];
                }
            }
            return [...DEFAULT_OFFERS];
        }

        function saveOffers(offers) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(offers));
            renderOffers();
        }

        // ------------------- æ¸²æŸ“å„ªæƒ å¡ (å«ç·¨è¼¯/åˆªé™¤æŒ‰éˆ•) -------------------
        function renderOffers() {
            const container = document.getElementById('links-container');
            if (!container) return;
            
            const offers = loadOffers();
            container.innerHTML = '';

            if (offers.length === 0) {
                container.innerHTML = '<div style="padding: 30px; background: #f8f9fa; border-radius: 8px; color: #666;">ğŸ“­ æš«ç„¡å„ªæƒ ï¼Œé»æ“Šã€Œæ–°å¢å„ªæƒ ã€é–‹å§‹</div>';
                return;
            }

            offers.forEach(offer => {
                const card = document.createElement('div');
                card.className = 'link-card';
                card.dataset.id = offer.id;
                
                // å·¦å´è³‡è¨Š
                const infoDiv = document.createElement('div');
                infoDiv.className = 'offer-info';
                infoDiv.innerHTML = `
                    <span class="price-tag">${escapeHtml(offer.name)}</span>
                    <span class="offer-url">${escapeHtml(offer.url)}</span>
                `;
                
                // å³å´æŒ‰éˆ•çµ„
                const btnGroup = document.createElement('div');
                btnGroup.className = 'button-group';
                
                const payBtn = document.createElement('button');
                payBtn.className = 'pay-btn';
                payBtn.textContent = 'é ˜å–';
                payBtn.dataset.baseUrl = offer.url;
                payBtn.onclick = function(e) { 
                    e.stopPropagation(); 
                    openPayMe(this); 
                };
                
                const editBtn = document.createElement('button');
                editBtn.className = 'edit-btn';
                editBtn.textContent = 'âœ ç·¨è¼¯';
                editBtn.onclick = function(e) {
                    e.stopPropagation();
                    showEditForm(offer.id);
                };
                
                const delBtn = document.createElement('button');
                delBtn.className = 'delete-btn';
                delBtn.textContent = 'ğŸ—‘ åˆªé™¤';
                delBtn.onclick = function(e) {
                    e.stopPropagation();
                    if (confirm(`ç¢ºå®šåˆªé™¤ã€Œ${offer.name}ã€ï¼Ÿ`)) {
                        deleteOffer(offer.id);
                    }
                };
                
                btnGroup.appendChild(payBtn);
                btnGroup.appendChild(editBtn);
                btnGroup.appendChild(delBtn);
                
                card.appendChild(infoDiv);
                card.appendChild(btnGroup);
                container.appendChild(card);
            });
        }

        // ------------------- åˆªé™¤å„ªæƒ  -------------------
        function deleteOffer(id) {
            const offers = loadOffers();
            const updated = offers.filter(o => o.id !== id);
            saveOffers(updated);
        }

        // ------------------- é¡¯ç¤ºç·¨è¼¯è¡¨å–® (å‹•æ…‹æ’å…¥) -------------------
        function showEditForm(id) {
            const offers = loadOffers();
            const offer = offers.find(o => o.id === id);
            if (!offer) return;

            // æš«æ™‚ç§»é™¤åŸæœ‰çš„ç·¨è¼¯è¡¨å–® (å¦‚æœæœ‰çš„è©±)
            const existingForm = document.getElementById('edit-form-container');
            if (existingForm) existingForm.remove();

            // å»ºç«‹ç·¨è¼¯å€å¡Š
            const container = document.getElementById('links-container');
            const editDiv = document.createElement('div');
            editDiv.id = 'edit-form-container';
            editDiv.className = 'edit-section';
            editDiv.style.marginTop = '20px';
            
            editDiv.innerHTML = `
                <h4>âœï¸ æ­£åœ¨ç·¨è¼¯å„ªæƒ </h4>
                <div class="form-group">
                    <label>å„ªæƒ åç¨±</label>
                    <input type="text" id="edit-name" value="${escapeHtml(offer.name)}" placeholder="ä¾‹å¦‚: å•†å ´ç¾é‡‘åˆ¸ $50">
                </div>
                <div class="form-group">
                    <label>PayMe é€£çµ</label>
                    <input type="url" id="edit-url" value="${escapeHtml(offer.url)}" placeholder="https://payme.hsbc/m/...">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="cancel-edit-btn" class="edit-btn" style="background: #6c757d;">å–æ¶ˆ</button>
                    <button id="save-edit-btn" class="save-btn">å„²å­˜ä¿®æ”¹</button>
                </div>
            `;
            
            container.parentNode.insertBefore(editDiv, container.nextSibling);
            
            // ç¶å®šå–æ¶ˆ
            document.getElementById('cancel-edit-btn').onclick = function() {
                editDiv.remove();
            };
            
            // ç¶å®šå„²å­˜
            document.getElementById('save-edit-btn').onclick = function() {
                const newName = document.getElementById('edit-name').value.trim();
                let newUrl = document.getElementById('edit-url').value.trim();
                
                if (!newName || !newUrl) {
                    alert('è«‹å¡«å¯«åç¨±èˆ‡é€£çµ');
                    return;
                }
                
                // ç°¡å–®é©—è­‰ PayMe æ ¼å¼ (éå¼·åˆ¶)
                if (!newUrl.startsWith('https://payme.hsbc/')) {
                    if (!confirm('é€£çµä¼¼ä¹ä¸æ˜¯ PayMe å®˜æ–¹æ ¼å¼ (https://payme.hsbc/...)ï¼Œç¢ºå®šç¹¼çºŒï¼Ÿ')) {
                        return;
                    }
                }
                
                const offers = loadOffers();
                const target = offers.find(o => o.id === id);
                if (target) {
                    target.name = newName;
                    target.url = newUrl;
                    saveOffers(offers);
                }
                editDiv.remove();
            };
        }

        // ------------------- æ–°å¢å„ªæƒ  -------------------
        function addNewOffer() {
            // ç§»é™¤èˆŠç·¨è¼¯è¡¨å–®
            const existingForm = document.getElementById('edit-form-container');
            if (existingForm) existingForm.remove();
            
            const container = document.getElementById('links-container');
            const addDiv = document.createElement('div');
            addDiv.id = 'edit-form-container';
            addDiv.className = 'edit-section';
            addDiv.style.marginTop = '20px';
            
            addDiv.innerHTML = `
                <h4>â• æ–°å¢å„ªæƒ </h4>
                <div class="form-group">
                    <label>å„ªæƒ åç¨±</label>
                    <input type="text" id="new-name" placeholder="ä¾‹å¦‚: è¶…å¸‚ç¦®åˆ¸ $100">
                </div>
                <div class="form-group">
                    <label>PayMe é€£çµ</label>
                    <input type="url" id="new-url" placeholder="https://payme.hsbc/m/...">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="cancel-add-btn" class="edit-btn" style="background: #6c757d;">å–æ¶ˆ</button>
                    <button id="save-add-btn" class="save-btn">æ–°å¢å„ªæƒ </button>
                </div>
            `;
            
            container.parentNode.insertBefore(addDiv, container.nextSibling);
            
            document.getElementById('cancel-add-btn').onclick = function() {
                addDiv.remove();
            };
            
            document.getElementById('save-add-btn').onclick = function() {
                const newName = document.getElementById('new-name').value.trim();
                let newUrl = document.getElementById('new-url').value.trim();
                
                if (!newName || !newUrl) {
                    alert('è«‹å¡«å¯«åç¨±èˆ‡é€£çµ');
                    return;
                }
                
                // ç°¡å–®é©—è­‰
                if (!newUrl.startsWith('https://payme.hsbc/')) {
                    if (!confirm('é€£çµä¼¼ä¹ä¸æ˜¯ PayMe å®˜æ–¹æ ¼å¼ (https://payme.hsbc/...)ï¼Œç¢ºå®šç¹¼çºŒï¼Ÿ')) {
                        return;
                    }
                }
                
                const offers = loadOffers();
                const newId = Date.now() + '-' + Math.random().toString(36).substring(2);
                offers.push({
                    id: newId,
                    name: newName,
                    url: newUrl
                });
                saveOffers(offers);
                addDiv.remove();
            };
        }

        // ------------------- é–‹å•Ÿ PayMe (åŠ  Token) -------------------
        async function openPayMe(button) {
            if (button.disabled) return;
            
            button.disabled = true;
            button.classList.add('loading-btn');
            const originalText = 'é ˜å–';
            button.textContent = 'è™•ç†ä¸­';
            
            try {
                const result = await fetchToken();
                const baseUrl = button.dataset.baseUrl;
                
                if (!baseUrl) throw new Error('ç„¡é€£çµ');
                
                const separator = baseUrl.includes('?') ? '&' : '?';
                const fullUrl = `${baseUrl}${separator}token=${encodeURIComponent(result.token)}`;
                
                window.open(fullUrl, '_blank');
                
                button.textContent = 'å·²é–‹å•Ÿ';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                    button.classList.remove('loading-btn');
                }, 1500);
                
            } catch (error) {
                console.error(error);
                if (confirm('ç„¡æ³•å–å¾— Tokenï¼Œæ˜¯å¦ç›´æ¥é–‹å•Ÿé€£çµï¼Ÿ')) {
                    window.open(button.dataset.baseUrl, '_blank');
                }
                button.textContent = 'é ˜å–';
                button.disabled = false;
                button.classList.remove('loading-btn');
            }
        }

        // ------------------- ç²å– Token (CORS é™ç´š) -------------------
        async function fetchToken() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);
                
                const response = await fetch(HSBC_API_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Apikey': HSBC_API_KEY,
                    },
                    signal: controller.signal
                }).catch(() => { throw new Error('CORS blocked'); });

                clearTimeout(timeoutId);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                let token = await response.text();
                token = token.trim().replace(/^"|"$/g, '');
                return { token, isMock: false };
                
            } catch (error) {
                console.warn('ä½¿ç”¨æ¨¡æ“¬ Token (CORS é˜»æ“‹)');
                document.getElementById('cors-warning').style.display = 'block';
                return { token: MOCK_TOKEN, isMock: true };
            }
        }

        // ------------------- æª¢æŸ¥CORSæç¤º -------------------
        async function checkCORS() {
            try {
                await fetch(HSBC_API_URL, { method: 'HEAD', mode: 'no-cors' });
            } catch (e) {
                document.getElementById('cors-warning').style.display = 'block';
            }
        }

        // ------------------- è¼”åŠ©å‡½æ•¸ -------------------
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ------------------- åˆå§‹åŒ– -------------------
        function initPage() {
            document.getElementById('user-name').textContent = 'è‡ªè¨‚æ¨¡å¼';
            
            // åˆå§‹åŒ–å„²å­˜
            if (!localStorage.getItem(STORAGE_KEY)) {
                saveOffers(DEFAULT_OFFERS);
            } else {
                renderOffers();
            }
            
            // ç¶å®šæ–°å¢æŒ‰éˆ•
            document.getElementById('addNewOfferBtn').onclick = addNewOffer;
            
            checkCORS();
        }

        window.onload = initPage;
    </script>

<veepn-lock-screen><style>@font-face{font-family:FigtreeVF;src:url(chrome-extension://majdfhpaihoncoakbjgbdhglocklcgno/fonts/FigtreeVF.woff2) format("woff2 supports variations"),url(chrome-extension://majdfhpaihoncoakbjgbdhglocklcgno/fonts/FigtreeVF.woff2) format("woff2-variations");font-weight:100 1000;font-display:swap}</style></veepn-lock-screen></body></html>
